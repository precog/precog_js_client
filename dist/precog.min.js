/*! precog 2013-04-27 */
(function(e){if("function"==typeof bootstrap)bootstrap("precog",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePrecog=e}else window.Precog=e()})(function(){function PrecogHttp(e){return PrecogHttp.http(e)}function Precog(e){return this instanceof Precog?(this.config=e,void 0):new Precog(e)}return function(){var e="undefined"!=typeof window?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var n,i,o=0,a=t,s="";e.charAt(0|o)||(a="=",o%1);s+=a.charAt(63&n>>8-8*(o%1))){if(i=e.charCodeAt(o+=.75),i>255)throw r;n=n<<8|i}return s}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4)throw r;for(var n,i,o=0,a=0,s="";i=e.charAt(a++);~i&&(n=o%4?64*n+i:i,o++%4)?s+=String.fromCharCode(255&n>>(6&-2*o)):0)i=t.indexOf(i);return s})}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,i,o,a,s=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?u+"":"null";case"boolean":case"null":return u+"";case"object":if(!u)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,r=0;o>r;r+=1)a[r]=str(r,u)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;o>r;r+=1)"string"==typeof rep[r]&&(n=rep[r],i=str(n,u),i&&a.push(quote(n)+(gap?": ":":")+i));else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(i=str(n,u),i&&a.push(quote(n)+(gap?": ":":")+i));return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n=walk(i,r),void 0!==n?i[r]=n:delete i[r]);return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),"undefined"!=typeof window&&"undefined"==typeof sessionStorage&&function(e){function t(){function t(){l.cookie=["sessionStorage="+e.encodeURIComponent(a=i.key(128))].join(";"),s=i.encode(a,s),o=new o(r,"name",r.name)}var n,l=(r.name,r.document),f=/\bsessionStorage\b=([^;]+)(;|$)/,p=f.exec(l.cookie);if(p){a=e.decodeURIComponent(p[1]),s=i.encode(a,s),o=new o(r,"name");for(var d=o.key(),n=0,h=d.length,y={};h>n;++n)0===(p=d[n]).indexOf(s)&&(u.push(p),y[p]=o.get(p),o.del(p));if(o=new o.constructor(r,"name",r.name),(this.length=u.length)>0){for(n=0,h=u.length,c=o.c,p=[];h>n;++n)p[n]=c.concat(o._c,o.escape(d=u[n]),c,c,(d=o.escape(y[d])).length,c,d);r.name+=p.join("")}}else t(),f.exec(l.cookie)||(u=null)}var r=e;try{for(;r!==r.top;)r=r.top}catch(n){}var i=function(e,t){return{decode:function(e,t){return this.encode(e,t)},encode:function(t,r){for(var n,i=t.length,o=r.length,a=[],s=[],u=0,c=0,l=0,f=0;256>u;++u)s[u]=u;for(u=0;256>u;++u)c=(c+(n=s[u])+t.charCodeAt(u%i))%256,s[u]=s[c],s[c]=n;for(c=0;o>l;++l)u=l%256,c=(c+(n=s[u]))%256,i=s[u]=s[c],s[c]=n,a[f++]=e(r.charCodeAt(l)^s[(i+n)%256]);return a.join("")},key:function(r){for(var n=0,i=[];r>n;++n)i[n]=e(1+(255*t()<<0));return i.join("")}}}(e.String.fromCharCode,e.Math.random),o=function(e){function t(e,t,r){this._i=(this._data=r||"").length,(this._key=t)?this._storage=e:(this._storage={_key:e||""},this._key="_key")}function r(e,t){var r=this.c;return r.concat(this._c,this.escape(e),r,r,(t=this.escape(t)).length,r,t)}return t.prototype.c=String.fromCharCode(1),t.prototype._c=".",t.prototype.clear=function(){this._storage[this._key]=this._data},t.prototype.del=function(e){var t=this.get(e);null!==t&&(this._storage[this._key]=this._storage[this._key].replace(r.call(this,e,t),""))},t.prototype.escape=e.escape,t.prototype.get=function(e){var t=this._storage[this._key],r=this.c,n=t.indexOf(e=r.concat(this._c,this.escape(e),r,r),this._i),i=null;return n>-1&&(n=t.indexOf(r,n+e.length-1)+1,i=t.substring(n,n=t.indexOf(r,n)),i=this.unescape(t.substr(++n,i))),i},t.prototype.key=function(){for(var e=this._storage[this._key],t=this.c,r=t+this._c,n=this._i,i=[],o=0,a=0;(n=e.indexOf(r,n))>-1;)i[a++]=this.unescape(e.substring(n+=2,o=e.indexOf(t,n))),n=e.indexOf(t,o)+2,o=e.indexOf(t,n),n=1+o+1*e.substring(n,o);return i},t.prototype.set=function(e,t){this.del(e),this._storage[this._key]+=r.call(this,e,t)},t.prototype.unescape=e.unescape,t}(e);"[object Opera]"===Object.prototype.toString.call(e.opera)&&(history.navigationMode="compatible",o.prototype.escape=e.encodeURIComponent,o.prototype.unescape=e.decodeURIComponent),t.prototype={length:0,key:function(e){if("number"!=typeof e||0>e||e>=u.length)throw"Invalid argument";return u[e]},getItem:function(e){if(e=s+e,f.call(l,e))return l[e];var t=o.get(e);return null!==t&&(t=l[e]=i.decode(a,t)),t},setItem:function(e,t){this.removeItem(e),e=s+e,o.set(e,i.encode(a,l[e]=""+t)),this.length=u.push(e)},removeItem:function(e){var t=o.get(e=s+e);null!==t&&(delete l[e],o.del(e),this.length=u.remove(e))},clear:function(){o.clear(),l={},u.length=0}};var a,s=r.document.domain,u=[],l={},f=l.hasOwnProperty;u.remove=function(e){var t=this.indexOf(e);return t>-1&&this.splice(t,1),this.length},u.indexOf||(u.indexOf=function(e){for(var t=0,r=this.length;r>t;++t)if(this[t]===e)return t;return-1}),r.sessionStorage&&(t=function(){},t.prototype=r.sessionStorage),t=new t,null!==u&&(e.sessionStorage=t)}(window),function(e){var t=function(e){this._res=e,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]};t.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(e){this.isResolved()||(this._isFulfilled=!0,this._res=e,this._callCallbacks(this._fulfilledCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=r)},reject:function(e){this.isResolved()||(this._isRejected=!0,this._res=e,this._callCallbacks(this._rejectedCallbacks,e),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=r)},notify:function(e){this.isResolved()||this._callCallbacks(this._progressCallbacks,e)},then:function(e,r,n){var i,o=new t;return this._isRejected||(i={promise:o,fn:e},this._isFulfilled?this._callCallbacks([i],this._res):this._fulfilledCallbacks.push(i)),this._isFulfilled||(i={promise:o,fn:r},this._isRejected?this._callCallbacks([i],this._res):this._rejectedCallbacks.push(i)),this.isResolved()||this._progressCallbacks.push({promise:o,fn:n}),o},fail:function(e){return this.then(r,e)},always:function(e){var t=this,r=function(){return e(t)};return this.then(r,r)},progress:function(e){return this.then(r,r,e)},spread:function(e,t){return this.then(function(t){return e.apply(this,t)},t)},done:function(){this.fail(o)},delay:function(e){return this.then(function(r){var n=new t;return setTimeout(function(){n.fulfill(r)},e),n})},timeout:function(e){var r=new t,n=setTimeout(function(){r.reject(Error("timed out"))},e);return r.sync(this),r.always(function(){clearTimeout(n)}),r},sync:function(e){var t=this;e.then(function(e){t.fulfill(e)},function(e){t.reject(e)})},_callCallbacks:function(e,t){var r=e.length;if(r){var o=this.isResolved(),s=this.isFulfilled();i(function(){for(var i,u,c,l=0;r>l;)if(i=e[l++],u=i.promise,c=i.fn,a(c)){var f;f=c(t),o?n.isPromise(f)?function(e){f.then(function(t){e.fulfill(t)},function(t){e.reject(t)})}(u):u.fulfill(f):u.notify(f)}else o?s?u.fulfill(t):u.reject(t):u.notify(t)})}}};var r,n={promise:function(e){return arguments.length?this.isPromise(e)?e:new t(e):new t},when:function(e,t,r,n){return this.promise(e).then(t,r,n)},fail:function(e,t){return this.when(e,r,t)},always:function(e,t){return this.promise(e).always(t)},progress:function(e,t){return this.promise(e).progress(t)},spread:function(e,t,r){return this.promise(e).spread(t,r)},done:function(e){this.isPromise(e)&&e.done()},isPromise:function(e){return e&&a(e.then)},valueOf:function(e){return this.isPromise(e)?e.valueOf():e},isFulfilled:function(e){return this.isPromise(e)?e.isFulfilled():!0},isRejected:function(e){return this.isPromise(e)?e.isRejected():!1},isResolved:function(e){return this.isPromise(e)?e.isResolved():!0},fulfill:function(e){return this.when(e,r,function(e){return e})},reject:function(e){return this.when(e,function(e){var r=new t;return r.reject(e),r})},resolve:function(e){return this.isPromise(e)?e:this.when(e)},invoke:function(e){return this.promise(e.apply(null,s.call(arguments,1)))},forEach:function(e,t,r,n){for(var i=n?n.length:e.length,o=0;i>o;)this.when(e[n?n[o]:o],t,r),++o},all:function(e){var r=new t,i=c(e),o=i?l(e):f(e),a=o.length,s=i?[]:{};if(!a)return r.fulfill(s),r;var u=a,p=function(){if(!--u){for(var t=0;a>t;)s[o[t]]=n.valueOf(e[o[t++]]);r.fulfill(s)}},d=function(e){r.reject(e)};return this.forEach(e,p,d,o),r},allResolved:function(e){var r=new t,n=c(e),i=n?l(e):f(e),o=i.length,a=n?[]:{};if(!o)return r.fulfill(a),r;var s=function(){--o||r.fulfill(e)};return this.forEach(e,s,s,i),r},any:function(e){var r=new t,n=e.length;if(!n)return r.reject(Error()),r;var i,o=0,a=function(e){r.fulfill(e)},s=function(e){o||(i=e),++o===n&&r.reject(i)};return this.forEach(e,a,s),r},delay:function(e,t){return this.promise(e).delay(t)},timeout:function(e,t){return this.promise(e).timeout(t)}},i=function(){if("object"==typeof process)return process.nextTick;if(e.setImmediate)return e.setImmediate;var t=[],r=function(){var e=t,r=0,n=t.length;for(t=[];n>r;)e[r++]()};if(e.postMessage){var n=!0;if(e.attachEvent){var i=function(){n=!1};e.attachEvent("onmessage",i),e.postMessage("__checkAsync","*"),e.detachEvent("onmessage",i)}if(n){var o="__promise"+ +new Date,a=function(e){e.data===o&&(e.stopPropagation&&e.stopPropagation(),r())};return e.addEventListener?e.addEventListener("message",a,!0):e.attachEvent("onmessage",a),function(r){1===t.push(r)&&e.postMessage(o,"*")}}}var s=e.document;if("onreadystatechange"in s.createElement("script")){var u=function(){var e=s.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,r()},(s.documentElement||s.body).appendChild(e)};return function(e){1===t.push(e)&&u()}}return function(e){setTimeout(e,0)}}(),o=function(e){i(function(){throw e})},a=function(e){return"function"==typeof e},s=Array.prototype.slice,u=Object.prototype.toString,c=Array.isArray||function(e){return"[object Array]"===u.call(e)},l=function(e){for(var t=[],r=0,n=e.length;n>r;)t.push(r++);return t},f=Object.keys||function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t};"object"==typeof exports?module.exports=n:"object"==typeof modules?modules.define("vow",function(e){e(n)}):"function"==typeof define?define(function(e,t,r){r.exports=n}):e.Vow=n}(this),"undefined"==typeof window&&(Vow=module.exports),function(e){var t={};t.makeBaseAuth=function(e,t){return"Basic "+("undefined"!=typeof btoa?btoa:exports.btoa)(e+":"+t)},t.addQuery=function(e,t){var r=e.lastIndexOf("#"),n="";r>=0&&(n="#"+e.substr(r+1),e=e.substr(0,r));var i=-1==e.indexOf("?")?"?":"&",o=[];for(var a in t)if(null!=t[a]){var s=""+t[a];s.length>0&&o.push(encodeURIComponent(a)+"="+encodeURIComponent(s))}return 0===o.length?e+n:e+i+o.join("&")+n},t.parseResponseHeaders=function(e){var r={};if(e.getAllResponseHeaders)for(var n=e.getAllResponseHeaders().split(/\r?\n/),i=0;n.length>i;i++)if(n[i]){var o=n[i],a=o.indexOf(":"),s=t.strtrim(o.substr(0,a)),u=t.strtrim(o.substr(a+1));r[s]=u}if(0===t.objsize(r)&&e.getResponseHeader){var c=e.getResponseHeader("Content-Type");c&&(r["Content-Type"]=c)}return r},t.info=function(e){return"undefined"!=typeof console&&(console.info?console.info(e):console.log(e)),e},t.error=function(e){return"undefined"!=typeof console&&(console.error?console.error(e):console.log(e)),e},t.debug=function(e){return"undefined"!=typeof console&&(console.debug?console.debug(e):console.log(e)),e},t.defopts=function(e){return function(r){var n={};return n.method=r.method||"GET",n.url=t.addQuery(r.url,r.query),n.content=r.content,n.headers=r.headers||{},n.success=r.success||t.info,n.failure=r.failure||t.error,n.progress=r.progress||t.debug,n.sync=r.sync||!1,r.basicAuth&&(n.headers.Authorization=t.makeBaseAuth(r.basicAuth.username,r.basicAuth.password)),e(n)}},t.responseCallback=function(e,t,r){e.status>=200&&300>e.status?t(e):r(e)},t.strtrim=function(e){return e.replace(/^\s+|\s+$/g,"")},t.objsize=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t},t.merge=function(e,t){var r,n={};for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n},e.createAjax=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},e.http=function(t){return"undefined"==typeof window?e.nodejs(t):"withCredentials"in e.createAjax()?e.ajax(t):e.jsonp(t)},e.ajax=t.defopts(function(r){var n=Vow.promise(),i=e.createAjax();i.open(r.method,r.url,r.sync),i.upload&&(i.upload.onprogress=function(e){e.lengthComputable&&r.progress({loaded:e.loaded,total:e.total})}),i.onreadystatechange=function(){var e=t.parseResponseHeaders(i);if(4===i.readyState){var r=this.responseText;if(null!=r)try{var o=e["Content-Type"];("application/json"==o||"text/json"==o)&&(r=JSON.parse(this.responseText))}catch(a){}t.responseCallback({headers:e,content:r,status:i.status,statusText:i.statusText},function(e){n.fulfill(e)},function(e){n.reject(e)})}};for(var o in r.headers){var a=r.headers[o];i.setRequestHeader(o,a)}return void 0!==r.content?r.headers["Content-Type"]?i.send(r.content):(i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(r.content))):i.send(null),n.then(r.success,r.failure)}),e.jsonp=t.defopts(function(e){var r=Math.floor(214748363*Math.random()),n="PrecogJsonpCallback"+(""+r),i=Vow.promise();window[n]=function(e,r){t.responseCallback({headers:r.headers,content:e,status:r.status.code,statusText:r.status.reason},function(e){i.fulfill(e)},function(e){i.reject(e)}),document.head.removeChild(document.getElementById(n));try{delete window[n]}catch(o){window[n]=void 0}};var o={method:e.method,callback:n};e.headers&&t.objsize(e.headers)>0&&(o.headers=JSON.stringify(e.headers)),void 0!==e.content&&(o.content=JSON.stringify(e.content));var a=document.createElement("SCRIPT");return a.addEventListener&&a.addEventListener("error",function(t){e.failure({headers:{},content:void 0,statusText:t.message||"Failed to load script from server",statusCode:400})},!0),a.setAttribute("type","text/javascript"),a.setAttribute("src",t.addQuery(e.url,o)),a.setAttribute("id",n),document.head||(document.head=document.getElementsByTagName("head")[0]),document.head.appendChild(a),i.then(e.success,e.failure)}),e.nodejs=t.defopts(function(e){var r=require("url").parse(e.url),n=require("https:"==r.protocol?"https":"http"),i=Vow.promise();r.method=e.method,r.headers=e.headers,e.content&&!e.headers["Content-Type"]&&(r.headers["Content-Type"]="application/json");var o=n.request(r,function(r){var n="";r.setEncoding("utf8"),r.on("data",function(t){n+=t,r.headers["content-length"]&&e.progress({loaded:n.length,total:r.headers["content-length"]})}),r.on("end",function(){var e=n,o=r.headers["content-type"];if(e&&("application/json"==o||"text/json"==o))try{e=JSON.parse(e)}catch(a){}t.responseCallback({headers:r.headers,content:e,status:r.statusCode,statusText:require("http").STATUS_CODES[r.statusCode]},function(e){i.fulfill(e)},function(e){i.reject(e)})})});return e.content&&o.write(e.headers["Content-Type"]&&"string"!=typeof e.content?JSON.stringify(e.content):e.content),o.end(),i.then(e.success,e.failure)}),e.get=function(r){return e.http(t.merge(r,{method:"GET"}))},e.put=function(r){return e.http(t.merge(r,{method:"PUT"}))},e.post=function(r){return e.http(t.merge(r,{method:"POST"}))},e.delete0=function(r){return e.http(t.merge(r,{method:"DELETE"}))},e.patch=function(r){return e.http(t.merge(r,{method:"PATCH"}))}}(PrecogHttp),function(e){var t={};t.error=function(e){throw"undefined"!=typeof console&&console.error(e),Error(e)},t.amap=function(e,t){for(var r=[],n=0;e.length>n;n++)r.push(t(e[n]));return r},t.acontains=function(e,t){for(var r=0;e.length>r;r++)if(e[r]==t)return!0;return!1},t.requireParam=function(e,r){null==e&&t.error('The parameter "'+r+'" may not be null or undefined')},t.requireField=function(e,r){(null==e||null==e[r])&&t.error('The field "'+r+'" may not be null or undefined')},t.removeTrailingSlash=function(e){return null==e||0===e.length?e:"/"==e.substr(e.length-1)?e.substr(0,e.length-1):e},t.composef=function(e,t){return e?t?function(r){return e(t(r))}:e:t},t.parentPath=function(e){var r=t.removeTrailingSlash(e),n=r.split("/"),i=n.slice(0,n.length-1);return i.length?i.join("/"):"/"},t.lastPathElement=function(e){var t=e.split("/");return 0===t.length?void 0:t[t.length-1]},t.extractField=function(e){return function(t){return t[e]}},t.extractContent=t.extractField("content"),t.unwrapSingleton=function(e){return e instanceof Array?e[0]:e},t.defSuccess=function(e){return t.composef(e,t.extractContent)},t.safeCallback=function(e){return null==e?function(e){return e}:e},t.defFailure=function(e){return e?e:function(e){throw Error(e.status+" "+e.statusText)}},t.sanitizePath=function(e){return e.replace(/\/+/g,"/")},t.merge=function(e,r){var n,i,o;if(void 0===e)return r;if(void 0===r)return e;if(!(e instanceof Array&&r instanceof Array)){if(e instanceof Object&&r instanceof Object){n={};for(i in e)n[i]=e[i];for(i in r)n[i]=void 0!==n[i]?t.merge(n[i],r[i]):r[i];return n}return r}for(n=[],o=0;e.length>o;o++)n.push(e[o]);for(o=0;r.length>o;o++)n.length>o?n[o]=t.merge(n[o],r[o]):n.push(r[o])},e.prototype.serviceUrl=function(e,r,n){return t.requireField(this.config,"analyticsService"),this.config.analyticsService+t.sanitizePath("/"+e+"/v"+r+"/"+(n||""))},e.prototype.accountsUrl=function(e){return this.serviceUrl("accounts",1,e)},e.prototype.securityUrl=function(e){return this.serviceUrl("security",1,e)},e.prototype.dataUrl=function(e){return this.serviceUrl("ingest",1,e)},e.prototype.analysisUrl=function(e){return this.serviceUrl("analytics",1,e)},e.prototype.metadataUrl=function(e){return this.serviceUrl("meta",1,e)},e.prototype.requireConfig=function(e){(null==this.config||null==this.config[e])&&t.error('The configuration field "'+e+'" may not be null or undefined')},e.GrantTypes={Append:"append",Replace:"replace",Execute:"execute",Mount:"mount",Create:"create",Explore:"explore"},e.FileTypes={JSON:"application/json",JSON_STREAM:"application/x-json-stream",CSV:"text/csv",ZIP:"application/zip",GZIP:"application/x-gzip",QUIRREL_SCRIPT:"text/x-quirrel-script"},e.prototype.createAccount=function(e,r,n){var i=this;return t.requireField(e,"email"),t.requireField(e,"password"),PrecogHttp.post({url:i.accountsUrl("accounts/"),content:e,success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.requestPasswordReset=function(e,r,n){var i=this;return t.requireParam(e,"email"),i.lookupAccountId(e,function(o){return PrecogHttp.post({url:i.accountsUrl("accounts")+"/"+o+"/password/reset",content:{email:e},success:t.defSuccess(r),failure:t.defFailure(n)})},t.defFailure(n))},e.prototype.lookupAccountId=function(e,r,n){var i=this,o=Vow.promise();return t.requireParam(e,"email"),PrecogHttp.get({url:i.accountsUrl("accounts/search"),query:{email:e},success:function(e){var r=t.unwrapSingleton(t.extractContent(e));return r?(o.fulfill(r),void 0):(o.reject({status:e.status,statusText:"No account ID found for given email"}),void 0)},failure:function(e){o.reject(e)}}),o.then(r,t.defFailure(n))},e.prototype.describeAccount=function(e,r,n){var i=this;return t.requireField(e,"email"),t.requireField(e,"password"),i.lookupAccountId(e.email,function(o){return PrecogHttp.get({basicAuth:{username:e.email,password:e.password},url:i.accountsUrl("accounts/"+o.accountId),success:t.defSuccess(r),failure:t.defFailure(n)})},t.defFailure(n))},e.prototype.addGrantToAccount=function(e,r,n){var i=this;return t.requireField(e,"accountId"),t.requireField(e,"grantId"),PrecogHttp.post({url:i.accountsUrl("accounts/"+e.accountId+"/grants/"),content:{grantId:e.grantId},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.currentPlan=function(e,r,n){var i=this;return t.requireField(e,"email"),t.requireField(e,"password"),i.lookupAccountId(e.email,function(o){return PrecogHttp.get({basicAuth:{username:e.email,password:e.password},url:i.accountsUrl("accounts/"+o.accountId+"/plan"),success:t.composef(r,t.composef(t.extractField("type"),t.extractContent)),failure:t.defFailure(n)})},t.defFailure(n))},e.prototype.changePlan=function(e,r,n){var i=this;return t.requireField(e,"email"),t.requireField(e,"password"),t.requireField(e,"plan"),i.lookupAccountId(e.email,function(o){return PrecogHttp.put({basicAuth:{username:e.email,password:e.password},url:i.accountsUrl("accounts/"+o.accountId+"/plan"),content:{type:e.plan},success:t.defSuccess(r),failure:t.defFailure(n)})},t.defFailure(n))},e.prototype.deletePlan=function(e,r,n){var i=this;return t.requireField(e,"email"),t.requireField(e,"password"),i.lookupAccountId(e.email,function(o){return PrecogHttp.delete0({basicAuth:{username:e.email,password:e.password},url:i.accountsUrl("accounts/"+o.accountId+"/plan"),success:t.composef(r,t.composef(t.extractField("type"),t.extractContent)),failure:t.defFailure(n)})},t.defFailure(n))},e.prototype.listApiKeys=function(e,r){var n=this;return n.requireConfig("apiKey"),PrecogHttp.get({url:n.securityUrl("apikeys/"),query:{apiKey:n.config.apiKey},success:t.defSuccess(e),failure:t.defFailure(r)})},e.prototype.createApiKey=function(e,r,n){var i=this;return t.requireParam(e,"grants"),i.requireConfig("apiKey"),PrecogHttp.post({url:i.securityUrl("apikeys/"),content:e,query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.describeApiKey=function(e,r,n){var i=this;return i.requireConfig("apiKey"),PrecogHttp.get({url:i.securityUrl("apikeys/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.deleteApiKey=function(e,r,n){var i=this;return t.requireParam(e,"apiKey"),i.requireConfig("apiKey"),PrecogHttp.delete0({url:i.securityUrl("apikeys/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.retrieveApiKeyGrants=function(e,r,n){var i=this;return t.requireParam(e,"apiKey"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.securityUrl("apikeys/"+e+"/grants/"),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.addGrantToApiKey=function(e,r,n){var i=this;return t.requireField(e,"grant"),t.requireField(e,"apiKey"),i.requireConfig("apiKey"),PrecogHttp.post({url:i.securityUrl("apikeys/"+e.apiKey+"/grants/"),content:e.grant,query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.removeGrantFromApiKey=function(e,r,n){var i=this;return t.requireField(e,"grantId"),t.requireField(e,"apiKey"),i.requireConfig("apiKey"),PrecogHttp.delete0({url:i.securityUrl("apikeys/"+e.apiKey+"/grants/"+e.grantId),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.createGrant=function(e,r,n){var i=this;return t.requireParam(e,"grant"),i.requireConfig("apiKey"),PrecogHttp.post({url:i.securityUrl("grants/"),content:e,query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.describeGrant=function(e,r,n){var i=this;return t.requireParam(e,"grantId"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.securityUrl("grants/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.deleteGrant=function(e,r,n){var i=this;return t.requireParam(e,"grantId"),i.requireConfig("apiKey"),PrecogHttp.delete0({url:i.securityUrl("grants/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.listGrantChildren=function(e,r,n){var i=this;return t.requireParam(e,"grantId"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.securityUrl("grants/"+e+"/children/"),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.createGrantChild=function(e,r,n){var i=this;return t.requireField(e,"parentGrantId"),t.requireField(e,"childGrant"),i.requireConfig("apiKey"),PrecogHttp.post({url:i.securityUrl("grants/"+e.parentGrantId+"/children/"),content:e.childGrant,query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.getMetadata=function(e,r,n){var i=this;return t.requireParam(e,"path"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.metadataUrl("fs/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype._retrieveMetadata=function(e,r,n){var i=this;return t.requireParam(e,"path"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.metadataUrl("fs/"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype._isEmulateData=function(e){if(t.requireParam(e,"path"),"undefined"!=typeof localStorage){var r=t.sanitizePath(e);return null!=localStorage.getItem("Precog."+r)}return!1},e.prototype._getEmulateData=function(e){t.requireParam(e,"path");var r={};if("undefined"!=typeof localStorage){var n=t.sanitizePath(e);r=JSON.parse(localStorage.getItem("Precog."+n)||"{}")}return r},e.prototype._setEmulateData=function(e,r){var n=this;if(t.requireParam(e,"path"),"undefined"!=typeof localStorage){var i=t.sanitizePath(e),o=n._getEmulateData(i);localStorage.setItem("Precog."+i,JSON.stringify(t.merge(o,r)))}},e.prototype.listChildren=function(e,r,n){function i(e){return e.children.concat(s)}var o=this;t.requireParam(e,"path");var a=o._getEmulateData(e),s=a.children||[];return this._retrieveMetadata(e).then(i).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.listDescendants=function(e,r,n){function i(e,r){return o.listChildren(e).then(function(n){var o=t.amap(n,function(t){var n=e+"/"+t;return i(n,r+t)});return Vow.all(o).then(function(e){var i=t.amap(n,function(e){return r+e});return[].concat.apply(i,e)})})}var o=this;return t.requireParam(e,"path"),i(e,"").then(t.safeCallback(r),t.safeCallback(n))},e.prototype.existsFile=function(e,r,n){var i=this;t.requireParam(e,"path");var o=t.parentPath(e),a=t.lastPathElement(e);return""===a&&t.error("To determine if a file exists, the file name must be specified"),i.listChildren(o).then(function(e){return t.acontains(e,a)}).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.uploadFile=function(r,n,i){var o,a=this;t.requireField(r,"path"),t.requireField(r,"type"),t.requireField(r,"contents"),a.requireConfig("apiKey");var s=t.parentPath(r.path),u=t.lastPathElement(r.path);""===u&&t.error("A file may only be uploaded to a specific directory");var c,l=s+"/"+u;switch(r.type){case e.FileTypes.JSON:case e.FileTypes.JSON_STREAM:case e.FileTypes.CSV:case e.FileTypes.ZIP:case e.FileTypes.GZIP:c=!1;break;default:c=!0}if(c){var f=a._getEmulateData(s),p=f.children||[];p.push(u),a._setEmulateData(s,{children:p});var d=a._getEmulateData(l);return d.type=r.type,d.contents=r.contents,d.version=d.version?d.version+1:1,d.lastModified=(new Date).getMilliseconds(),a._setEmulateData(l,d),"text/x-quirrel-script"===r.type?a.executeFile({path:l}).then(function(e){var t=e.data;return uploadFile({path:l,type:"application/json",contents:t})}).then(function(){return{versions:{head:d.version}}}).then(t.safeCallback(n),t.safeCallback(i)):(o=Vow.promise(),o.fulfill({versions:{head:d.version}}),o.then(t.safeCallback(n),t.safeCallback(i)))}return o=Vow.promise(),a.delete0(l).then(function(){return PrecogHttp.post({url:a.dataUrl((r.async?"async":"sync")+"/fs"+l),content:r.contents,query:{apiKey:a.config.apiKey,ownerAccountId:r.ownerAccountId,delimiter:r.delimiter,quote:r.quote,escape:r.escape},headers:{"Content-Type":r.type}}).then(function(e){o.fulfill(e.content)})}).done(),o.then(t.safeCallback(n),t.safeCallback(i))},e.prototype.createFile=function(e,r,n){var i=this;return t.requireField(e,"path"),t.requireField(e,"type"),t.requireFiled(e,"contents"),i.existsFile(e.path).then(function(r){return r?(t.error("The file "+e.path+" already exists"),void 0):i.uploadFile(e)}).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.retrieveFile=function(e,r,n){var i=this;if(i._isEmulateData(e)){var o=i._getEmulateData(e),a=Vow.promise();return a.fulfill({content:o.content,type:o.type}),a.then(t.safeCallback(r),t.safeCallback(n))}return i.execute({query:'load("'+e+'")'},function(e){return{content:JSON.stringify(e),type:"application/json"}}).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.append=function(e,t,r){return e.values=[e.value],delete e.value,this.appendAll(e,t,r)},e.prototype.appendAll=function(e,r,n){var i=this;t.requireField(e,"value"),t.requireField(e,"path"),i.requireConfig("apiKey");var o=t.parentPath(e.path),a=t.lastPathElement(e.path);""===a&&t.error("Data must be appended to a specific file.");var s=o+"/"+a;return PrecogHttp.post({url:i.dataUrl(e.async?"async":"sync")+"/fs"+s,content:e.values,query:{apiKey:i.config.apiKey,ownerAccountId:e.ownerAccountId},headers:{"Content-Type":"application/json"},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.delete0=function(e,r,n){var i=this;return t.requireParam(e,"path"),i.requireConfig("apiKey"),"undefined"!=typeof localStorage&&localStorage.getItem(e)&&localStorage.removeItem(e),PrecogHttp.delete0({url:i.dataUrl("async/fs"+e),query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.deleteAll=function(e,r,n){var i=this;return t.requireParam(e,"path"),i.requireConfig("apiKey"),i.listDescendants(e).then(function(r){var n=r.concat([e]),o=t.amap(n,function(e){return i.delete0(e)});return Vow.all(o)}).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.copyFile=function(e,r,n){var i=this;return t.requireField(e,"source"),t.requireField(e,"destination"),i.retrieveFile(e.source,function(n){return i.uploadFile({path:e.destination,type:n.type,contents:n.content}).then(t.defSuccess(r))
},t.defFailure(n))},e.prototype.moveFile=function(e,r,n){var i=this;return t.requireField(e,"source"),t.requireField(e,"destination"),i.copyFile(e,function(){return i.delete0(e.source).then(t.defSuccess(r))},t.defFailure(n))},e.prototype.moveDirectory=function(e,r,n){var i=this;return t.requireField(e,"source"),t.requireField(e,"destination"),i.listDescendants(e.source,function(n){for(var o=[],a=0;n.length>a;a++)o.push(i.copyFile({source:e.source+"/"+n[a],destination:e.destination+"/"+n[a]}));return Vow.all(o).then(function(){return i.deleteAll(e.source)}).then(t.defSuccess(r))},t.defFailure(n))},e.prototype.executeFile=function(e,r,n){var i=this;if(t.requireField(e,"path"),i._isEmulateData(e.path)&&e.maxAge){var o=i._getEmulateData(e.path);if(o.cached){var a=o.cached,s=(new Date).getMilliseconds()/1e3,u=s-a.timestamp;if(e.maxAge>u||e.maxStale&&e.maxAge+e.maxStale>u){var c=Vow.promise();return c.fulfill(a.results),c.then(t.safeCallback(r),t.safeCallback(n))}}}return i.retrieveFile(e.path).then(function(r){if("text/x-quirrel-script"===r.type){var n={query:r.contents};return i.execute(n).then(function(t){if(!("undefined"==typeof localStorage||t.errors&&t.errors.length)){var n=i._getEmulateData(e.path);n.type="text/x-quirrel-script",n.contents=r.contents,n.cached={results:t,timestamp:(new Date).getMilliseconds()/1e3},i._setEmulateData(e.path,n)}return t})}t.error("The file "+e.path+" does not have type text/x-quirrel-script and therefore cannot be executed")}).then(t.safeCallback(r),t.safeCallback(n))},e.prototype.execute=function(e,r,n){var i=this;return t.requireField(e,"query"),i.requireConfig("apiKey"),PrecogHttp.get({url:i.analysisUrl("fs/"+e.path),query:{apiKey:i.config.apiKey,q:e.query,limit:e.limit,skip:e.skip,sortOn:e.sortOn},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.asyncQuery=function(e,r,n){var i=this;return t.requireField(e,"query"),PrecogHttp.post({url:i.analysisUrl("queries"),query:{apiKey:i.config.apiKey,q:e.query,limit:e.limit,basePath:e.basePath,skip:e.skip,order:e.order,sortOn:e.sortOn,sortOrder:e.sortOrder,timeout:e.timeout,prefixPath:e.prefixPath,format:e.format},success:t.defSuccess(r),failure:t.defFailure(n)})},e.prototype.asyncQueryResults=function(e,r,n){var i=this;return t.requireParam(e,"jobId"),PrecogHttp.get({url:i.analysisUrl("queries/")+e,query:{apiKey:i.config.apiKey},success:t.defSuccess(r),failure:t.defFailure(n)})}}(Precog),{http:PrecogHttp,api:Precog}});