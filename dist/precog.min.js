/*! precog 2013-09-16 */
!function(a){if("function"==typeof bootstrap)bootstrap("precog",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePrecog=a}else window.Precog=a()}(function(){function PrecogHttp(a){return PrecogHttp.http(a)}function Precog(a){return this instanceof Precog?(this.config=a,void 0):new Precog(a)}if(function(){var a="undefined"!=typeof window?window:exports,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=function(){try{document.createElement("$")}catch(a){return a}}();a.btoa||(a.btoa=function(a){for(var d,e,f=0,g=b,h="";a.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&d>>8-8*(f%1))){if(e=a.charCodeAt(f+=.75),e>255)throw c;d=d<<8|e}return h}),a.atob||(a.atob=function(a){if(a=a.replace(/=+$/,""),1==a.length%4)throw c;for(var d,e,f=0,g=0,h="";e=a.charAt(g++);~e&&(d=f%4?64*d+e:e,f++%4)?h+=String.fromCharCode(255&d>>(6&-2*f)):0)e=b.indexOf(e);return h})}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),"undefined"!=typeof window)"undefined"==typeof sessionStorage&&!function(a){function b(){function b(){k.cookie=["sessionStorage="+a.encodeURIComponent(h=f.key(128))].join(";"),i=f.encode(h,i),g=new g(d,"name",d.name)}var e,k=(d.name,d.document),l=/\bsessionStorage\b=([^;]+)(;|$)/,m=l.exec(k.cookie);if(m){h=a.decodeURIComponent(m[1]),i=f.encode(h,i),g=new g(d,"name");for(var n=g.key(),e=0,o=n.length,p={};o>e;++e)0===(m=n[e]).indexOf(i)&&(j.push(m),p[m]=g.get(m),g.del(m));if(g=new g.constructor(d,"name",d.name),0<(this.length=j.length)){for(e=0,o=j.length,c=g.c,m=[];o>e;++e)m[e]=c.concat(g._c,g.escape(n=j[e]),c,c,(n=g.escape(p[n])).length,c,n);d.name+=m.join("")}}else b(),l.exec(k.cookie)||(j=null)}var d=a;try{for(;d!==d.top;)d=d.top}catch(e){}var f=function(a,b){return{decode:function(a,b){return this.encode(a,b)},encode:function(b,c){for(var d,e=b.length,f=c.length,g=[],h=[],i=0,j=0,k=0,l=0;256>i;++i)h[i]=i;for(i=0;256>i;++i)j=(j+(d=h[i])+b.charCodeAt(i%e))%256,h[i]=h[j],h[j]=d;for(j=0;f>k;++k)i=k%256,j=(j+(d=h[i]))%256,e=h[i]=h[j],h[j]=d,g[l++]=a(c.charCodeAt(k)^h[(e+d)%256]);return g.join("")},key:function(c){for(var d=0,e=[];c>d;++d)e[d]=a(1+(255*b()<<0));return e.join("")}}}(a.String.fromCharCode,a.Math.random),g=function(a){function b(a,b,c){this._i=(this._data=c||"").length,(this._key=b)?this._storage=a:(this._storage={_key:a||""},this._key="_key")}function c(a,b){var c=this.c;return c.concat(this._c,this.escape(a),c,c,(b=this.escape(b)).length,c,b)}return b.prototype.c=String.fromCharCode(1),b.prototype._c=".",b.prototype.clear=function(){this._storage[this._key]=this._data},b.prototype.del=function(a){var b=this.get(a);null!==b&&(this._storage[this._key]=this._storage[this._key].replace(c.call(this,a,b),""))},b.prototype.escape=a.escape,b.prototype.get=function(a){var b=this._storage[this._key],c=this.c,d=b.indexOf(a=c.concat(this._c,this.escape(a),c,c),this._i),e=null;return d>-1&&(d=b.indexOf(c,d+a.length-1)+1,e=b.substring(d,d=b.indexOf(c,d)),e=this.unescape(b.substr(++d,e))),e},b.prototype.key=function(){for(var a=this._storage[this._key],b=this.c,c=b+this._c,d=this._i,e=[],f=0,g=0;-1<(d=a.indexOf(c,d));)e[g++]=this.unescape(a.substring(d+=2,f=a.indexOf(b,d))),d=a.indexOf(b,f)+2,f=a.indexOf(b,d),d=1+f+1*a.substring(d,f);return e},b.prototype.set=function(a,b){this.del(a),this._storage[this._key]+=c.call(this,a,b)},b.prototype.unescape=a.unescape,b}(a);"[object Opera]"===Object.prototype.toString.call(a.opera)&&(history.navigationMode="compatible",g.prototype.escape=a.encodeURIComponent,g.prototype.unescape=a.decodeURIComponent),b.prototype={length:0,key:function(a){if("number"!=typeof a||0>a||j.length<=a)throw"Invalid argument";return j[a]},getItem:function(a){if(a=i+a,l.call(k,a))return k[a];var b=g.get(a);return null!==b&&(b=k[a]=f.decode(h,b)),b},setItem:function(a,b){this.removeItem(a),a=i+a,g.set(a,f.encode(h,k[a]=""+b)),this.length=j.push(a)},removeItem:function(a){var b=g.get(a=i+a);null!==b&&(delete k[a],g.del(a),this.length=j.remove(a))},clear:function(){g.clear(),k={},j.length=0}};var h,i=d.document.domain,j=[],k={},l=k.hasOwnProperty;j.remove=function(a){var b=this.indexOf(a);return b>-1&&this.splice(b,1),this.length},j.indexOf||(j.indexOf=function(a){for(var b=0,c=this.length;c>b;++b)if(this[b]===a)return b;return-1}),d.sessionStorage&&(b=function(){},b.prototype=d.sessionStorage),b=new b,null!==j&&(a.sessionStorage=b)}(window);else{var storage={};localStorage={setItem:function(a,b){storage[a]=b},getItem:function(a){return storage[a]},removeItem:function(a){delete storage[a]}}}return function(a){var b=function(a){this._res=a,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]};b.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(a){this.isResolved()||(this._isFulfilled=!0,this._res=a,this._callCallbacks(this._fulfilledCallbacks,a),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=c)},reject:function(a){this.isResolved()||(this._isRejected=!0,this._res=a,this._callCallbacks(this._rejectedCallbacks,a),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=c)},notify:function(a){this.isResolved()||this._callCallbacks(this._progressCallbacks,a)},then:function(a,c,d){var e,f=new b;return this._isRejected||(e={promise:f,fn:a},this._isFulfilled?this._callCallbacks([e],this._res):this._fulfilledCallbacks.push(e)),this._isFulfilled||(e={promise:f,fn:c},this._isRejected?this._callCallbacks([e],this._res):this._rejectedCallbacks.push(e)),this.isResolved()||this._progressCallbacks.push({promise:f,fn:d}),f},fail:function(a){return this.then(c,a)},always:function(a){var b=this,c=function(){return a(b)};return this.then(c,c)},progress:function(a){return this.then(c,c,a)},spread:function(a,b){return this.then(function(b){return a.apply(this,b)},b)},done:function(){this.fail(f)},delay:function(a){return this.then(function(c){var d=new b;return setTimeout(function(){d.fulfill(c)},a),d})},timeout:function(a){var c=new b,d=setTimeout(function(){c.reject(Error("timed out"))},a);return c.sync(this),c.always(function(){clearTimeout(d)}),c},sync:function(a){var b=this;a.then(function(a){b.fulfill(a)},function(a){b.reject(a)})},_callCallbacks:function(a,b){var c=a.length;if(c){var f=this.isResolved(),h=this.isFulfilled();e(function(){for(var e,i,j,k=0;c>k;)if(e=a[k++],i=e.promise,j=e.fn,g(j)){var l;l=j(b),f?d.isPromise(l)?function(a){l.then(function(b){a.fulfill(b)},function(b){a.reject(b)})}(i):i.fulfill(l):i.notify(l)}else f?h?i.fulfill(b):i.reject(b):i.notify(b)})}}};var c,d={promise:function(a){return arguments.length?this.isPromise(a)?a:new b(a):new b},when:function(a,b,c,d){return this.promise(a).then(b,c,d)},fail:function(a,b){return this.when(a,c,b)},always:function(a,b){return this.promise(a).always(b)},progress:function(a,b){return this.promise(a).progress(b)},spread:function(a,b,c){return this.promise(a).spread(b,c)},done:function(a){this.isPromise(a)&&a.done()},isPromise:function(a){return a&&g(a.then)},valueOf:function(a){return this.isPromise(a)?a.valueOf():a},isFulfilled:function(a){return this.isPromise(a)?a.isFulfilled():!0},isRejected:function(a){return this.isPromise(a)?a.isRejected():!1},isResolved:function(a){return this.isPromise(a)?a.isResolved():!0},fulfill:function(a){return this.when(a,c,function(a){return a})},reject:function(a){return this.when(a,function(a){var c=new b;return c.reject(a),c})},resolve:function(a){return this.isPromise(a)?a:this.when(a)},invoke:function(a){return this.promise(a.apply(null,h.call(arguments,1)))},forEach:function(a,b,c,d){for(var e=d?d.length:a.length,f=0;e>f;)this.when(a[d?d[f]:f],b,c),++f},all:function(a){var c=new b,e=j(a),f=e?k(a):l(a),g=f.length,h=e?[]:{};if(!g)return c.fulfill(h),c;var i=g,m=function(){if(!--i){for(var b=0;g>b;)h[f[b]]=d.valueOf(a[f[b++]]);c.fulfill(h)}},n=function(a){c.reject(a)};return this.forEach(a,m,n,f),c},allResolved:function(a){var c=new b,d=j(a),e=d?k(a):l(a),f=e.length,g=d?[]:{};if(!f)return c.fulfill(g),c;var h=function(){--f||c.fulfill(a)};return this.forEach(a,h,h,e),c},any:function(a){var c=new b,d=a.length;if(!d)return c.reject(Error()),c;var e,f=0,g=function(a){c.fulfill(a)},h=function(a){f||(e=a),++f===d&&c.reject(e)};return this.forEach(a,g,h),c},delay:function(a,b){return this.promise(a).delay(b)},timeout:function(a,b){return this.promise(a).timeout(b)}},e=function(){if("object"==typeof process)return process.nextTick;if(a.setImmediate)return a.setImmediate;var b=[],c=function(){var a=b,c=0,d=b.length;for(b=[];d>c;)a[c++]()};if(a.postMessage){var d=!0;if(a.attachEvent){var e=function(){d=!1};a.attachEvent("onmessage",e),a.postMessage("__checkAsync","*"),a.detachEvent("onmessage",e)}if(d){var f="__promise"+ +new Date,g=function(a){a.data===f&&(a.stopPropagation&&a.stopPropagation(),c())};return a.addEventListener?a.addEventListener("message",g,!0):a.attachEvent("onmessage",g),function(c){1===b.push(c)&&a.postMessage(f,"*")}}}var h=a.document;if("onreadystatechange"in h.createElement("script")){var i=function(){var a=h.createElement("script");a.onreadystatechange=function(){a.parentNode.removeChild(a),a=a.onreadystatechange=null,c()},(h.documentElement||h.body).appendChild(a)};return function(a){1===b.push(a)&&i()}}return function(a){setTimeout(a,0)}}(),f=function(a){e(function(){throw a})},g=function(a){return"function"==typeof a},h=Array.prototype.slice,i=Object.prototype.toString,j=Array.isArray||function(a){return"[object Array]"===i.call(a)},k=function(a){for(var b=[],c=0,d=a.length;d>c;)b.push(c++);return b},l=Object.keys||function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b};"object"==typeof exports?module.exports=d:"object"==typeof modules?modules.define("vow",function(a){a(d)}):"function"==typeof define?define(function(a,b,c){c.exports=d}):a.Vow=d}(this),"undefined"==typeof window&&(Vow=module.exports),function(a){var b={};b.makeBaseAuth=function(a,b){return"Basic "+("undefined"!=typeof btoa?btoa:exports.btoa)(a+":"+b)},b.addQuery=function(a,b){var c=a.lastIndexOf("#"),d="";c>=0&&(d="#"+a.substr(c+1),a=a.substr(0,c));var e=-1==a.indexOf("?")?"?":"&",f=[];for(var g in b)if(null!=b[g]){var h=b[g].toString();h.length>0&&f.push(encodeURIComponent(g)+"="+encodeURIComponent(h))}return 0===f.length?a+d:a+e+f.join("&")+d},b.parseResponseHeaders=function(a){var c={};if(a.getAllResponseHeaders)for(var d=a.getAllResponseHeaders().split(/\r?\n/),e=0;e<d.length;e++)if(d[e]){var f=d[e],g=f.indexOf(":"),h=b.strtrim(f.substr(0,g)),i=b.strtrim(f.substr(g+1));c[h]=i}if(0===b.objsize(c)&&a.getResponseHeader){var j=a.getResponseHeader("Content-Type");j&&(c["Content-Type"]=j)}return c},b.defopts=function(a){return function(c){var d={};return d.method=c.method||"GET",d.url=b.addQuery(c.url,c.query),d.content=c.content,d.headers=c.headers||{},d.success=c.success,d.failure=c.failure,d.progress=c.progress,d.sync=c.sync||!1,c.basicAuth&&(d.headers.Authorization=b.makeBaseAuth(c.basicAuth.username,c.basicAuth.password)),a(d)}},b.responseCallback=function(a,b,c){a.status>=200&&a.status<300?b(a):c(a)},b.strtrim=function(a){return a.replace(/^\s+|\s+$/g,"")},b.objsize=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},b.merge=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d},a.createAjax=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},a.http=function(b){return"undefined"==typeof window?a.nodejs(b):"withCredentials"in a.createAjax()?a.ajax(b):a.jsonp(b)},a.ajax=b.defopts(function(c){var d=Vow.promise(),e=a.createAjax();e.open(c.method,c.url,!c.sync),e.upload&&(e.upload.onprogress=function(a){a.lengthComputable&&c.progress&&c.progress({loaded:a.loaded,total:a.total})}),e.onreadystatechange=function(){var a=b.parseResponseHeaders(e);if(4===e.readyState){var c=this.responseText;if(null!=c)try{var f=a["Content-Type"];("application/json"==f||"text/json"==f)&&(c=JSON.parse(this.responseText))}catch(g){}b.responseCallback({headers:a,content:c,status:e.status,statusText:e.statusText},function(a){d.fulfill(a)},function(a){d.reject(a)})}};for(var f in c.headers){var g=c.headers[f];e.setRequestHeader(f,g)}return void 0!==c.content?c.headers["Content-Type"]?e.send(c.content):(e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(c.content))):e.send(null),d.then(c.success,c.failure)}),a.jsonp=b.defopts(function(a){var c=Math.floor(214748363*Math.random()),d="PrecogJsonpCallback"+c.toString(),e=Vow.promise();window[d]=function(a,c){b.responseCallback({headers:c.headers,content:a,status:c.status.code,statusText:c.status.reason},function(a){e.fulfill(a)},function(a){e.reject(a)}),document.head.removeChild(document.getElementById(d));try{delete window[d]}catch(f){window[d]=void 0}};var f={method:a.method,callback:d};a.headers&&b.objsize(a.headers)>0&&(f.headers=JSON.stringify(a.headers)),void 0!==a.content&&(f.content=JSON.stringify(a.content));var g=document.createElement("SCRIPT");return g.addEventListener&&g.addEventListener("error",function(b){a.failure({headers:{},content:void 0,statusText:b.message||"Failed to load script from server",statusCode:400})},!0),g.setAttribute("type","text/javascript"),g.setAttribute("src",b.addQuery(a.url,f)),g.setAttribute("id",d),document.head||(document.head=document.getElementsByTagName("head")[0]),document.head.appendChild(g),e.then(a.success,a.failure)}),a.nodejs=b.defopts(function(a){var c=require("url").parse(a.url),d=require("https:"==c.protocol?"https":"http"),e=Vow.promise();c.method=a.method,c.headers=a.headers,a.content&&!a.headers["Content-Type"]&&(c.headers["Content-Type"]="application/json");var f=d.request(c,function(c){var d="";c.setEncoding("utf8"),c.on("data",function(b){d+=b,c.headers["content-length"]&&a.progress&&a.progress({loaded:d.length,total:c.headers["content-length"]})}),c.on("end",function(){var a=d,f=c.headers["content-type"];if(a&&("application/json"==f||"text/json"==f))try{a=JSON.parse(a)}catch(g){}b.responseCallback({headers:c.headers,content:a,status:c.statusCode,statusText:require("http").STATUS_CODES[c.statusCode]},function(a){e.fulfill(a)},function(a){e.reject(a)})})});return a.content&&f.write(a.headers["Content-Type"]&&"string"!=typeof a.content?JSON.stringify(a.content):a.content),f.end(),e.then(a.success,a.failure)}),a.get=function(c){return a.http(b.merge(c,{method:"GET"}))},a.put=function(c){return a.http(b.merge(c,{method:"PUT"}))},a.post=function(c){return a.http(b.merge(c,{method:"POST"}))},a.delete0=function(c){return a.http(b.merge(c,{method:"DELETE"}))},a.patch=function(c){return a.http(b.merge(c,{method:"PATCH"}))}}(PrecogHttp),function(a){var b={};b.error=function(a){throw"undefined"!=typeof console&&console.error(a),new Error(a)},b.amap=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d]));return c},b.acontains=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},b.requireParam=function(a,c){null==a&&b.error('The parameter "'+c+'" may not be null or undefined')},b.requireField=function(a,c){(null==a||null==a[c])&&b.error('The field "'+c+'" may not be null or undefined')},b.removeTrailingSlash=function(a){return null==a||0===a.length?a:"/"==a.substr(a.length-1)?a.substr(0,a.length-1):a},b.composef=function(a,b){return a?b?function(c){return a(b(c))}:a:b},b.parentPath=function(a){var c=b.removeTrailingSlash(b.sanitizePath(a)),d=c.split("/"),e=d.slice(0,d.length-1);return e.length?e.join("/"):"/"},b.lastPathElement=function(a){var c=b.sanitizePath(a),d=c.split("/");return 0===d.length?void 0:d[d.length-1]},b.extractField=function(a){return function(b){return b[a]}},b.extractContent=b.extractField("content"),b.safeCallback=function(a){return null==a?function(a){return a}:function(b){var c=a(b);return void 0===c?b:c}},b.sanitizePath=function(a){return a.replace(/\/+/g,"/")},b.merge=function(a,c){var d,e,f;if(void 0===a)return a;if(void 0===c)return a;if(a instanceof Array&&c instanceof Array){for(d=[],f=0;f<a.length;f++)d.push(a[f]);for(f=0;f<c.length;f++)d.length>f?d[f]=b.merge(d[f],c[f]):d.push(c[f]);return d}if(a instanceof Object&&c instanceof Object){d={};for(e in a)d[e]=a[e];for(e in c)d[e]=void 0!==d[e]?b.merge(d[e],c[e]):c[e];return d}return c},b.addCallbacks=function(a){return function(c,d,e){return a.call(this,c).then(b.safeCallback(d),e)}},a.prototype.serviceUrl=function(a,c,d){return b.requireField(this.config,"analyticsService"),this.config.analyticsService+b.sanitizePath("/"+a+"/v"+c+"/"+(d||""))},a.prototype.accountsUrl=function(a){return this.serviceUrl("accounts",1,a)},a.prototype.securityUrl=function(a){return this.serviceUrl("security",1,a)},a.prototype.dataUrl=function(a){return this.serviceUrl("ingest",1,a)},a.prototype.analysisUrl=function(a){return this.serviceUrl("analytics",1,a)},a.prototype.metadataUrl=function(a){return this.serviceUrl("meta",1,a)},a.prototype.requireConfig=function(a){(null==this.config||null==this.config[a])&&b.error('The configuration field "'+a+'" may not be null or undefined')},a.GrantTypes={Append:"append",Replace:"replace",Execute:"execute",Mount:"mount",Create:"create",Explore:"explore"},a.FileTypes={JSON:"application/json",JSON_STREAM:"application/x-json-stream",CSV:"text/csv",ZIP:"application/zip",GZIP:"application/x-gzip",QUIRREL_SCRIPT:"text/x-quirrel-script"},a.prototype.createAccount=b.addCallbacks(function(a){var c=this;return b.requireField(a,"email"),b.requireField(a,"password"),PrecogHttp.post({url:c.accountsUrl("accounts/"),content:a,success:b.extractContent})}),a.prototype.requestPasswordReset=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"email"),c.lookupAccountId(a).then(function(d){return PrecogHttp.post({url:c.accountsUrl("accounts")+"/"+d.accountId+"/password/reset",content:{email:a},success:b.extractContent})})}),a.prototype.lookupAccountId=b.addCallbacks(function(a){var c=this,d=Vow.promise();return b.requireParam(a,"email"),PrecogHttp.get({url:c.accountsUrl("accounts/search"),query:{email:a},success:function(a){var b=a.content;b&&0!==b.length?d.fulfill(b[0]):d.reject({status:400,statusText:"No account ID found for given email"})},failure:d.reject}),d}),a.prototype.describeAccount=b.addCallbacks(function(a){var c=this;return b.requireField(a,"email"),b.requireField(a,"password"),c.lookupAccountId(a.email).then(function(d){return PrecogHttp.get({basicAuth:{username:a.email,password:a.password},url:c.accountsUrl("accounts/"+d.accountId),success:b.extractContent})})}),a.prototype.addGrantToAccount=b.addCallbacks(function(a){var c=this;return b.requireField(a,"accountId"),b.requireField(a,"grantId"),PrecogHttp.post({url:c.accountsUrl("accounts/"+a.accountId+"/grants/"),content:{grantId:a.grantId},success:b.extractContent})}),a.prototype.currentPlan=b.addCallbacks(function(a){var c=this;return b.requireField(a,"email"),b.requireField(a,"password"),c.lookupAccountId(a.email).then(function(d){return PrecogHttp.get({basicAuth:{username:a.email,password:a.password},url:c.accountsUrl("accounts/"+d.accountId+"/plan"),success:b.composef(b.extractField("type"),b.extractContent)})})}),a.prototype.changePlan=b.addCallbacks(function(a){var c=this;return b.requireField(a,"email"),b.requireField(a,"password"),b.requireField(a,"plan"),c.lookupAccountId(a.email).then(function(d){return PrecogHttp.put({basicAuth:{username:a.email,password:a.password},url:c.accountsUrl("accounts/"+d.accountId+"/plan"),content:{type:a.plan},success:b.extractContent})})}),a.prototype.deletePlan=b.addCallbacks(function(a){var c=this;return b.requireField(a,"email"),b.requireField(a,"password"),c.lookupAccountId(a.email).then(function(d){return PrecogHttp.delete0({basicAuth:{username:a.email,password:a.password},url:c.accountsUrl("accounts/"+d.accountId+"/plan"),success:b.composef(b.extractField("type"),b.extractContent)})})}),a.prototype.listApiKeys=function(a,c){var d=this;return d.requireConfig("apiKey"),PrecogHttp.get({url:d.securityUrl("apikeys/"),query:{apiKey:d.config.apiKey},success:b.extractContent}).then(b.safeCallback(a),c)},a.prototype.createApiKey=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"grants"),c.requireConfig("apiKey"),PrecogHttp.post({url:c.securityUrl("apikeys/"),content:a,query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.describeApiKey=b.addCallbacks(function(a){var c=this;return c.requireConfig("apiKey"),PrecogHttp.get({url:c.securityUrl("apikeys/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.deleteApiKey=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"apiKey"),c.requireConfig("apiKey"),PrecogHttp.delete0({url:c.securityUrl("apikeys/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.retrieveApiKeyGrants=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"apiKey"),c.requireConfig("apiKey"),PrecogHttp.get({url:c.securityUrl("apikeys/"+a+"/grants/"),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.addGrantToApiKey=b.addCallbacks(function(a){var c=this;return b.requireField(a,"grant"),b.requireField(a,"apiKey"),c.requireConfig("apiKey"),PrecogHttp.post({url:c.securityUrl("apikeys/"+a.apiKey+"/grants/"),content:a.grant,query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.removeGrantFromApiKey=b.addCallbacks(function(a){var c=this;return b.requireField(a,"grantId"),b.requireField(a,"apiKey"),c.requireConfig("apiKey"),PrecogHttp.delete0({url:c.securityUrl("apikeys/"+a.apiKey+"/grants/"+a.grantId),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.createGrant=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"grant"),c.requireConfig("apiKey"),PrecogHttp.post({url:c.securityUrl("grants/"),content:a,query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.describeGrant=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"grantId"),c.requireConfig("apiKey"),PrecogHttp.get({url:c.securityUrl("grants/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.deleteGrant=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"grantId"),c.requireConfig("apiKey"),PrecogHttp.delete0({url:c.securityUrl("grants/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.listGrantChildren=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"grantId"),c.requireConfig("apiKey"),PrecogHttp.get({url:c.securityUrl("grants/"+a+"/children/"),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.createGrantChild=b.addCallbacks(function(a){var c=this;return b.requireField(a,"parentGrantId"),b.requireField(a,"childGrant"),c.requireConfig("apiKey"),PrecogHttp.post({url:c.securityUrl("grants/"+a.parentGrantId+"/children/"),content:a.childGrant,query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype._retrieveMetadata=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"path"),c.requireConfig("apiKey"),PrecogHttp.get({url:c.metadataUrl("fs/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype._uniqueHash=function(){var a=this,b=function(a){var b=0;if(0===a.length)return b;for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);b=(b<<5)-b+d,b&=b}return b};return a.requireConfig("apiKey"),b("Precog"+a.config.apiKey)},a.prototype._localStorageKey=function(a){return this._uniqueHash()+a},a.prototype._isEmulateData=function(a){var c=this;if(b.requireParam(a,"path"),"undefined"!=typeof localStorage){var d=b.sanitizePath(a);return null!=localStorage.getItem(c._localStorageKey(d))}return!1},a.prototype._getEmulateData=function(a){var c=this;b.requireParam(a,"path");var d={};if("undefined"!=typeof localStorage){var e=b.sanitizePath(a);d=JSON.parse(localStorage.getItem(c._localStorageKey(e))||"{}")}else console&&console.error&&console.error("Missing local storage!");return d},a.prototype._deleteEmulateData=function(a){var c=this;if(b.requireParam(a,"path"),"undefined"!=typeof localStorage){var d=b.sanitizePath(a);localStorage.removeItem(c._localStorageKey(d))}else console&&console.error&&console.error("Missing local storage!")},a.prototype._setEmulateData=function(a,c){var d=this;if(b.requireParam(a,"path"),"undefined"!=typeof localStorage){var e=b.sanitizePath(a);localStorage.setItem(d._localStorageKey(e),JSON.stringify(c))}else console&&console.error&&console.error("Missing local storage!")},a.prototype._getChildren=function(a){var c,d,e,f=this,g=[];if("undefined"!=typeof localStorage){var h=b.sanitizePath(a);for(c in localStorage)c.indexOf(f._localStorageKey(h))||(d=c.substr(f._localStorageKey(h).length),e=d.substr(0,-1==d.indexOf("/")?d.length:d.indexOf("/")),e&&-1==g.indexOf(e)&&g.push(e))}else console&&console.error&&console.error("Missing local storage!");return g},a.prototype._getTypedChildren=function(a){var c,d=this._getChildren(a),e=[],f=b.sanitizePath(a+"/");for(c=0;c<d.length;c++)e.push({name:d[c],type:this._getChildren(f+d[c]+"/").length?"directory":"file"});return e},a.prototype.getMetadata=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"path"),c.requireConfig("apiKey"),c.listChildren(a).then(function(d){return c.getNodeType(a).then(function(e){var f={};if(b.acontains(e,"directory")&&(f.defaultFiles={"text/x-quirrel-script":"index.qrl","text/html":"index.html"},f.children=d),b.acontains(e,"file"))if(c._isEmulateData(a)){var g=c._getEmulateData(a);f.type=g.type}else f.type="application/json";return f})})}),a.prototype.getNodeType=b.addCallbacks(function(a){var c=this;b.requireParam(a,"path"),c.requireConfig("apiKey");var d=b.sanitizePath(a),e=function(a){return c.execute({query:'count(load("'+a+'"))'}).then(function(a){return a.data&&a.data[0]||0})},f=function(a){return c._retrieveMetadata(a).then(function(a){return a.children})};return f(d).then(function(a){return e(d).then(function(b){var e=[];return a.length>0&&e.push("directory"),(b>0||c._isEmulateData(d))&&e.push("file"),e})})}),a.prototype.listChildren=b.addCallbacks(function(a){var c=this;b.requireParam(a,"path");var d=c._getTypedChildren(a);return this._retrieveMetadata(a).then(function(e){var f=e.children||[];return Vow.all(b.amap(f,function(b){return c.getNodeType(a+"/"+b)})).then(function(a){var c,e,g=[],h=[];for(c=0;c<f.length;c++){e=b.removeTrailingSlash(f[c]),h.push(e);for(var i=a[c],j=0;j<i.length;j++){var k=i[j];g.push({type:k,name:e})}}for(c=0;c<d.length;c++)e=b.removeTrailingSlash(d[c].name),-1==h.indexOf(e)&&g.push({name:e,type:d[c].type});return g})})}),a.prototype.listDescendants=b.addCallbacks(function(a){function c(a,e){return d.listChildren(a).then(function(d){var f=b.amap(d,function(c){return("/"===c.name||""===c.name)&&b.error("Infinite recursion"),b.sanitizePath(a+"/"+c.name)}),g=[];b.amap(f,function(a){b.acontains(g,a)||g.push(a)});var h=b.amap(g,function(a){return a.substr(e.length)}),i=b.amap(g,function(a){return c(a,e)});return Vow.all(i).then(function(a){return[].concat.apply(h,a)})})}var d=this;b.requireParam(a,"path");var e=b.sanitizePath(a+"/");return c(e,e)}),a.prototype.existsFile=b.addCallbacks(function(a){var c=this;b.requireParam(a,"path");var d=b.parentPath(a),e=b.lastPathElement(a);return""===e&&b.error("To determine if a file exists, the file name must be specified"),c.listChildren(d).then(function(a){var c=b.amap(a,function(a){return a.name});return b.acontains(c,e)})}),a.prototype.uploadFile=b.addCallbacks(function(c){var d,e=this;b.requireField(c,"path"),b.requireField(c,"type"),b.requireField(c,"contents"),e.requireConfig("apiKey"),"string"!=typeof c.contents&&b.error("File contents must be a string");var f=b.parentPath(c.path),g=b.lastPathElement(c.path);""===g&&b.error("A file may only be uploaded to a specific directory");var h,i=f+"/"+g;switch(c.type){case a.FileTypes.JSON:case a.FileTypes.JSON_STREAM:case a.FileTypes.CSV:case a.FileTypes.ZIP:case a.FileTypes.GZIP:h=!1;break;default:h=!0}if(h){var j=e._getEmulateData(i);return j.type=c.type,j.contents=c.contents,j.version=j.version?j.version+1:1,j.lastModified=(new Date).getTime(),e._setEmulateData(i,j),"text/x-quirrel-script"===c.type?e.executeFile({path:i}).then(function(a){return e.uploadFile({path:i,type:"application/json",contents:JSON.stringify(a.data),saveEmulation:!0})}).then(function(){return{versions:{head:j.version}}}):(d=Vow.promise(),d.fulfill({versions:{head:j.version}}),d)}var k=function(){return PrecogHttp.post({url:e.dataUrl((c.async?"async":"sync")+"/fs/"+i),content:c.contents,query:{apiKey:e.config.apiKey,ownerAccountId:c.ownerAccountId,delimiter:c.delimiter,quote:c.quote,escape:c.escape},headers:{"Content-Type":c.type},success:b.extractContent})};return PrecogHttp.delete0({url:e.dataUrl("async/fs/"+i),query:{apiKey:e.config.apiKey},success:b.extractContent}).then(k,k)}),a.prototype.createFile=b.addCallbacks(function(a){var c=this;return b.requireField(a,"path"),b.requireField(a,"type"),b.requireFiled(a,"contents"),c.existsFile(a.path).then(function(d){return d?(b.error("The file "+a.path+" already exists"),void 0):c.uploadFile(a)
})}),a.prototype.getFile=b.addCallbacks(function(a){var c=this;if(b.requireParam(a,"path"),c._isEmulateData(a)){var d=c._getEmulateData(a),e=Vow.promise();return e.fulfill({contents:d.contents,type:d.type}),e}return c.execute({query:'load("'+a+'")'}).then(function(a){return{contents:JSON.stringify(a.data),type:"application/json"}})}),a.prototype.append=b.addCallbacks(function(a){return a.values=[a.value],delete a.value,this.appendAll(a)}),a.prototype.appendAll=b.addCallbacks(function(a){var c=this;b.requireField(a,"values"),b.requireField(a,"path"),c.requireConfig("apiKey");var d=b.parentPath(a.path),e=b.lastPathElement(a.path);""===e&&b.error("Data must be appended to a specific file.");var f=d+"/"+e;return PrecogHttp.post({url:c.dataUrl(a.async?"async":"sync")+"/fs/"+f,content:a.values,query:{apiKey:c.config.apiKey,ownerAccountId:a.ownerAccountId},success:b.extractContent})}),a.prototype.delete0=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"path"),c.requireConfig("apiKey"),c._deleteEmulateData(a),PrecogHttp.delete0({url:c.dataUrl("async/fs/"+a),query:{apiKey:c.config.apiKey},success:b.extractContent})}),a.prototype.deleteAll=b.addCallbacks(function(a){var c=this;b.requireParam(a,"path"),c.requireConfig("apiKey");var d=b.sanitizePath(a);return c.listDescendants(d).then(function(a){var e=b.amap(a,function(a){return b.sanitizePath(d+"/"+a)}).concat([d]);return Vow.all(b.amap(e,function(a){return c.delete0(a)}))})}),a.prototype.copyFile=b.addCallbacks(function(a){var c=this;return b.requireField(a,"source"),b.requireField(a,"dest"),c.getFile(a.source).then(function(b){return c.uploadFile({path:a.dest,type:b.type,contents:b.contents})})}),a.prototype.moveFile=b.addCallbacks(function(a){var c=this;return b.requireField(a,"source"),b.requireField(a,"dest"),c.copyFile(a).then(function(){return c.delete0(a.source)})}),a.prototype.moveDirectory=b.addCallbacks(function(a){var c=this;return b.requireField(a,"source"),b.requireField(a,"dest"),c.listDescendants(a.source).then(function(b){for(var d=[],e=0;e<b.length;e++){var f=a.source+"/"+b[e],g=a.dest+"/"+b[e];d.push(c.copyFile({source:f,dest:g}))}return Vow.all(d).then(function(){return c.deleteAll(a.source)})})}),a.prototype.executeFile=b.addCallbacks(function(a){var c=this;if(b.requireField(a,"path"),c._isEmulateData(a.path)&&a.maxAge){var d=c._getEmulateData(a.path);if(d.cached){var e=d.cached,f=(new Date).getTime()/1e3,g=f-e.timestamp;if(g<a.maxAge||a.maxStale&&g<a.maxAge+a.maxStale){var h=Vow.promise();return h.fulfill(e.results),h}}}return c.getFile(a.path).then(function(d){var e=b.parentPath(a.path);if("text/x-quirrel-script"===d.type){var f=b.sanitizePath("/"+e+"/"),g=f.split("/").join("//"),h=d.contents.split("/./").join(g).split('"./').join('"'+f),i={query:h};return c.execute(i).then(function(b){if("undefined"!=typeof localStorage&&b&&(null==b.errors||0===b.errors.length)){var d=c._getEmulateData(a.path);d.cached={results:b,timestamp:(new Date).getTime()/1e3},c._setEmulateData(a.path,d)}return b})}b.error("The file "+a.path+" does not have type text/x-quirrel-script and therefore cannot be executed")})}),a.prototype.execute=b.addCallbacks(function(a){var c=this;return b.requireField(a,"query"),c.requireConfig("apiKey"),PrecogHttp.get({url:c.analysisUrl("fs/"+(a.path||"")),query:{apiKey:c.config.apiKey,q:a.query,limit:a.limit,skip:a.skip,order:a.order,sortOn:a.sortOn,sortOrder:a.sortOrder,timeout:a.timeout,prefixPath:a.prefixPath,format:a.format||"detailed"},success:b.extractContent})}),a.prototype._asyncQuery=b.addCallbacks(function(a){var c=this;return b.requireField(a,"query"),PrecogHttp.post({url:c.analysisUrl("queries"),query:{apiKey:c.config.apiKey,q:a.query,limit:a.limit,basePath:a.path,skip:a.skip,order:a.order,sortOn:a.sortOn,sortOrder:a.sortOrder,timeout:a.timeout,prefixPath:a.prefixPath,format:a.format},success:b.extractContent})}),a.prototype._asyncQueryResults=b.addCallbacks(function(a){var c=this;return b.requireParam(a,"jobId"),PrecogHttp.get({url:c.analysisUrl("queries/")+a,query:{apiKey:c.config.apiKey},success:b.extractContent})})}(Precog),{http:PrecogHttp,api:Precog}});